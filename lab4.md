University: ITMO University

Faculty: ICT

Course: Network programming

Year: 2022/2023

Group: K34212

Author: Sorokina Irina

Lab3

Цель работы

Изучить синтаксис языка программирования P4 и выполнить 2 задания обучающих задания от Open network foundation для ознакомления на практике с P4.

Ход работы

Склонировала репозиторий p4lang/tutorials и установила Vagrant с помощью VPN. После обновления VirtualBox перешла в папку «cd vm-ubuntu-20.04» и используя Vagrant развернула тестовую среду vagrant up. В результате установки появилась виртуальная машина с аккаунтами login/password vagrant/vagrant и p4/p4.

![image](https://user-images.githubusercontent.com/58992611/212840157-30ffb404-f3b0-42b9-80bc-975837acb212.png)

Basic Forwarding

Схема связи:

![image](https://user-images.githubusercontent.com/58992611/212840232-a9633fbe-f3b6-4331-995d-d8cb7d27100c.png)

Запустила файл basic.p4, чтобы проверить его поведение. Для этого включила переключатель в Mininet с помощью команды «make run», после этого увидела командную строку Mininet. Пинг не проходит между хостами в системе. Вышла из командной строки Mininet и остановила Mininet.

![image](https://user-images.githubusercontent.com/58992611/212840357-4c6f48d5-4fd2-4f0a-ad5d-f623f0b45cdd.png)

Внесла изменения в секции «Ingress Processing» и «Deparser».

![image](https://user-images.githubusercontent.com/58992611/212840406-adacb0a6-cb65-4fb4-9831-af06c9ccb3d2.png)

![image](https://user-images.githubusercontent.com/58992611/212840436-4ff74342-224a-4ccf-9f20-108393406f2c.png)

Затем снова запустила Mininet и пробовала пинг между хостами. Можно наблюдать, что пинги успешно проходят.

![image](https://user-images.githubusercontent.com/58992611/212840523-ba14637c-c91c-4af2-b4e4-aa6804a1b8b3.png)

Basic Tunneling

Схема связи:

![image](https://user-images.githubusercontent.com/58992611/212840605-c1eebe02-6ad8-4977-b1aa-9010067c42c5.png)

Теперь необходимо добавить поддержку базового протокола туннелирования на основе предыдущего задания. 
Зашла в директорию ~/tutorials/exercises/basic_tunnel и внесла изменения в файл basick_tunnel.p4. Определила новый тип заголовка для инкапсуляции IP-пакета и изменила код программы, чтобы она могла определить порт назначения, используя новый заголовок туннеля.
Далее в Minilet выполнила команду «xterm h1 h2». В результате были открыты два терминала:

![image](https://user-images.githubusercontent.com/58992611/212840673-07b2e578-0592-4be9-aeb0-d1e7d91bd004.png)

На хосте h2 подняла сервер командой «./receive.py».
На h1 была выполнена команда «./send.py 10.0.2.2 "P4 is cool"» для отправки сообщения хосту h2 пакета без туннелирования, но с указанием ip адреса получателя. Видим, что итоговый пакет успешно дошел до адресата. Он содержит заголовки TCP, Ethernet, IPv4 и само переданное сообщение.

![image](https://user-images.githubusercontent.com/58992611/212840719-6143575f-3dff-4c02-9607-c3b84e0de25f.png)

Затем с хоста h1 отправила хосту h2 туннелированный пакет на IP-адрес третьего коммутатора, при этом указав "dst_id" второго коммутатора. В этом случае IP адрес не важен, важен только id назначения. Пакет не дошел до отправителя и ушел на второй коммутатор, потому что коммутатор больше не использует заголовок IP для маршрутизации, когда заголовок "MyTunnel" находится в пакете.

![image](https://user-images.githubusercontent.com/58992611/212840782-b6ed6367-ada4-41c0-90fc-52630e3b69f9.png)

Вывод:

В ходе выполнения лабораторной работы была создана виртуальная машина и изучены основы синтаксиса языка программирования P4. Выполнила 2 программы, где было детально разобрано стандартное перенаправление пакетов, а также туннелирование.
